{"ast":null,"code":"var _jsxFileName = \"/home/eduardo/Documentos/Projects/Ethereum/web-application-ethereum/src/components/Campaign.js\";\nimport React, { Component } from \"react\";\nimport { createContract } from './../ethereum/crowdfundingContract';\nimport { web3 } from \"../ethereum/web3\";\nimport { Table, Button, Input } from 'semantic-ui-react';\nexport class Campaign extends Component {\n  constructor(props) {\n    super(props);\n    this.ONGOING_STATE = '0';\n    this.FAILED_STATE = '1';\n    this.SUCCEEDED_STATE = '2';\n    this.PAID_OUT_STATE = '3';\n    this.state = {\n      campaign: {\n        name: 'N/A',\n        targetAmount: 0,\n        totalCollected: 0,\n        campaignFinished: false,\n        deadline: new Date(0),\n        isBeneficiary: false,\n        state: ''\n      },\n      contributionAmount: '0'\n    };\n    this.onContribute = this.onContribute.bind(this);\n  }\n\n  async componentDidMount() {\n    const currentCampaign = await this.getCampaign(this.getCampaignAddress());\n    this.setState({\n      campaign: currentCampaign\n    });\n  }\n\n  getCampaignAddress() {\n    return this.props.match.params.address;\n  } // getCampaign(address) {\n  //   return {\n  //     name: 'Contract name',\n  //     targetAmount: 100,\n  //     totalCollected: 50,\n  //     campaignFinished: false,\n  //     deadline: new Date(),\n  //     state: this.ONGOING_STATE\n  //   }\n  // }\n\n\n  async getCampaign(address) {\n    const contract = createContract(address);\n    const name = await contract.methods.name().call();\n    const targetAmount = await contract.methods.targetAmount().call();\n    const totalCollected = await contract.methods.totalCollected().call();\n    const beforeDeadline = await contract.methods.beforeDeadline().call();\n    const beneficiary = await contract.methods.beneficiary().call();\n    const deadlineSeconds = await contract.methods.fundingDeadline().call();\n    const state = await contract.methods.state().call();\n    var deadlineDate = new Date(0);\n    deadlineDate.setUTCSeconds(deadlineSeconds);\n    const accounts = await web3.eth.getAccounts();\n    const account = accounts[1];\n    console.log('Nome:' + accounts);\n    return {\n      name: name,\n      targetAmount: targetAmount,\n      totalCollected: totalCollected,\n      campaignFinished: !beforeDeadline,\n      deadline: new Date(),\n      state: this.ONGOING_STATE\n    }; // return {\n    //   name: name,\n    //   targetAmount: targetAmount,\n    //   totalCollected: totalCollected,\n    //   campaignFinished: !beforeDeadline,\n    //   deadline: deadlineDate,\n    //   isBeneficiary: beneficiary.toLowerCase() === account.toLowerCase(),\n    //   state: state\n    // }\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Table, {\n      celled: true,\n      padded: true,\n      color: \"teal\",\n      striped: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Table.Header, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Table.Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Table.HeaderCell, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 15\n      }\n    }, \"Name\"), /*#__PURE__*/React.createElement(Table.HeaderCell, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 15\n      }\n    }, \"Value\"))), /*#__PURE__*/React.createElement(Table.Body, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Table.Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Table.Cell, {\n      singleLine: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 15\n      }\n    }, \"Name\"), /*#__PURE__*/React.createElement(Table.Cell, {\n      singleLine: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 15\n      }\n    }, this.state.campaign.name)), /*#__PURE__*/React.createElement(Table.Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Table.Cell, {\n      singleLine: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 15\n      }\n    }, \"Target Amount\"), /*#__PURE__*/React.createElement(Table.Cell, {\n      singleLine: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 15\n      }\n    }, this.state.campaign.targetAmount)), /*#__PURE__*/React.createElement(Table.Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Table.Cell, {\n      singleLine: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 15\n      }\n    }, \"Total Collected\"), /*#__PURE__*/React.createElement(Table.Cell, {\n      singleLine: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 15\n      }\n    }, this.state.campaign.totalCollected)), /*#__PURE__*/React.createElement(Table.Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Table.Cell, {\n      singleLine: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 15\n      }\n    }, \"Campaign Finished\"), /*#__PURE__*/React.createElement(Table.Cell, {\n      singleLine: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 15\n      }\n    }, this.state.campaign.campaignFinished)), /*#__PURE__*/React.createElement(Table.Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Table.Cell, {\n      singleLine: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 15\n      }\n    }, \"Deadline\"), /*#__PURE__*/React.createElement(Table.Cell, {\n      singleLine: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 15\n      }\n    }, this.state.campaign.deadline.toDateString())), /*#__PURE__*/React.createElement(Table.Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Table.Cell, {\n      singleLine: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 15\n      }\n    }, \"Is beneficiary\"), /*#__PURE__*/React.createElement(Table.Cell, {\n      singleLine: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 15\n      }\n    }, this.state.campaign.isBeneficiary)), /*#__PURE__*/React.createElement(Table.Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Table.Cell, {\n      singleLine: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 15\n      }\n    }, \"State\"), /*#__PURE__*/React.createElement(Table.Cell, {\n      singleLine: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 15\n      }\n    }, this.state.campaign.state)))));\n  }\n\n  campaignInteractionSection() {\n    if (this.state.campaign.campaignFinished) {\n      return this.postCampaignInterface();\n    } else {\n      return this.contributeInterface();\n    }\n  }\n\n  postCampaignInterface() {\n    if (this.state.campaign.state === this.ONGOING_STATE) {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 14\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        type: \"submit\",\n        positive: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181,\n          columnNumber: 9\n        }\n      }, \"Finish campaign\"));\n    }\n\n    if (this.state.campaign.state === this.SUCCEEDED_STATE && this.state.campaign.isBeneficiary === true) {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 14\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        type: \"submit\",\n        negative: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 9\n        }\n      }, \"Collect funds\"));\n    }\n\n    if (this.state.campaign.state === this.FAILED_STATE) {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 14\n        }\n      }, /*#__PURE__*/React.createElement(Button, {\n        type: \"submit\",\n        negative: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 9\n        }\n      }, \"Refund\"));\n    }\n  }\n\n  contributeInterface() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 12\n      }\n    }, /*#__PURE__*/React.createElement(Input, {\n      action: {\n        color: 'teal',\n        content: 'Contribute',\n        onClick: this.onContribute\n      },\n      actionPosition: \"left\",\n      label: \"ETH\",\n      labelPosition: \"right\",\n      placeholder: \"1\",\n      onChange: e => this.setState({\n        contributionAmount: e.target.value\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 7\n      }\n    }));\n  }\n\n  onContribute(event) {\n    alert(`Contributing ${this.state.contributionAmount} to a contract`);\n  }\n\n}","map":{"version":3,"sources":["/home/eduardo/Documentos/Projects/Ethereum/web-application-ethereum/src/components/Campaign.js"],"names":["React","Component","createContract","web3","Table","Button","Input","Campaign","constructor","props","ONGOING_STATE","FAILED_STATE","SUCCEEDED_STATE","PAID_OUT_STATE","state","campaign","name","targetAmount","totalCollected","campaignFinished","deadline","Date","isBeneficiary","contributionAmount","onContribute","bind","componentDidMount","currentCampaign","getCampaign","getCampaignAddress","setState","match","params","address","contract","methods","call","beforeDeadline","beneficiary","deadlineSeconds","fundingDeadline","deadlineDate","setUTCSeconds","accounts","eth","getAccounts","account","console","log","render","toDateString","campaignInteractionSection","postCampaignInterface","contributeInterface","color","content","onClick","e","target","value","event","alert"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { createContract } from './../ethereum/crowdfundingContract'\nimport { web3 } from \"../ethereum/web3\";\nimport { Table, Button, Input } from 'semantic-ui-react'\n\nexport class Campaign extends Component {\n  ONGOING_STATE = '0';\n  FAILED_STATE = '1';\n  SUCCEEDED_STATE = '2';\n  PAID_OUT_STATE = '3';\n\n  state = {\n    campaign: {\n      name: 'N/A',\n      targetAmount: 0,\n      totalCollected: 0,\n      campaignFinished: false,\n      deadline: new Date(0),\n      isBeneficiary: false,\n      state: ''\n    },\n    contributionAmount: '0'\n  }\n\n  constructor(props) {\n    super(props);\n    this.onContribute = this.onContribute.bind(this);\n  }\n\n  async componentDidMount() {\n    const currentCampaign = await this.getCampaign(this.getCampaignAddress());\n    this.setState({\n      campaign: currentCampaign\n    })\n  }\n\n  getCampaignAddress() {\n    return this.props.match.params.address;\n  }\n\n  // getCampaign(address) {\n  //   return {\n  //     name: 'Contract name',\n  //     targetAmount: 100,\n  //     totalCollected: 50,\n  //     campaignFinished: false,\n  //     deadline: new Date(),\n  //     state: this.ONGOING_STATE\n  //   }\n  // }\n\n  async getCampaign(address) {\n    const contract = createContract(address);\n\n    const name = await contract.methods.name().call();\n    const targetAmount = await contract.methods.targetAmount().call();\n    const totalCollected = await contract.methods.totalCollected().call();\n    const beforeDeadline = await contract.methods.beforeDeadline().call();\n    const beneficiary = await contract.methods.beneficiary().call();\n    const deadlineSeconds = await contract.methods.fundingDeadline().call();\n    const state = await contract.methods.state().call();\n\n    var deadlineDate = new Date(0);\n    deadlineDate.setUTCSeconds(deadlineSeconds);\n\n    const accounts = await web3.eth.getAccounts();\n    const account = accounts[1];\n    console.log('Nome:' + accounts)\n\n    return {\n      name: name,\n      targetAmount: targetAmount,\n      totalCollected: totalCollected,\n      campaignFinished: !beforeDeadline,\n      deadline: new Date(),\n      state: this.ONGOING_STATE\n    }\n    // return {\n    //   name: name,\n    //   targetAmount: targetAmount,\n    //   totalCollected: totalCollected,\n    //   campaignFinished: !beforeDeadline,\n    //   deadline: deadlineDate,\n    //   isBeneficiary: beneficiary.toLowerCase() === account.toLowerCase(),\n    //   state: state\n    // }\n  }\n\n  render() {\n    return(\n      <div>\n        <Table celled padded color=\"teal\" striped>\n          <Table.Header>\n            <Table.Row>\n              <Table.HeaderCell>Name</Table.HeaderCell>\n              <Table.HeaderCell>Value</Table.HeaderCell>\n            </Table.Row>\n          </Table.Header>\n\n          <Table.Body>\n            <Table.Row>\n              <Table.Cell singleLine>\n                Name\n              </Table.Cell>\n              <Table.Cell singleLine>\n                {this.state.campaign.name}\n              </Table.Cell>\n            </Table.Row>\n\n            <Table.Row>\n              <Table.Cell singleLine>\n                Target Amount\n              </Table.Cell>\n              <Table.Cell singleLine>\n                {this.state.campaign.targetAmount}\n              </Table.Cell>\n            </Table.Row>\n\n            <Table.Row>\n              <Table.Cell singleLine>\n                Total Collected\n              </Table.Cell>\n              <Table.Cell singleLine>\n                {this.state.campaign.totalCollected}\n              </Table.Cell>\n            </Table.Row>\n\n            <Table.Row>\n              <Table.Cell singleLine>\n                Campaign Finished\n              </Table.Cell>\n              <Table.Cell singleLine>\n                {this.state.campaign.campaignFinished}\n              </Table.Cell>\n            </Table.Row>\n\n            <Table.Row>\n              <Table.Cell singleLine>\n                Deadline\n              </Table.Cell>\n              <Table.Cell singleLine>\n                {this.state.campaign.deadline.toDateString()}\n              </Table.Cell>\n            </Table.Row>\n\n            <Table.Row>\n              <Table.Cell singleLine>\n                Is beneficiary\n              </Table.Cell>\n              <Table.Cell singleLine>\n                {this.state.campaign.isBeneficiary}\n              </Table.Cell>\n            </Table.Row>\n\n            <Table.Row>\n              <Table.Cell singleLine>\n                State\n              </Table.Cell>\n              <Table.Cell singleLine>\n                {this.state.campaign.state}\n              </Table.Cell>\n            </Table.Row>\n\n          </Table.Body>\n        </Table>\n      </div>\n    );\n  }\n\n  campaignInteractionSection() {\n    if (this.state.campaign.campaignFinished) {\n      return this.postCampaignInterface();\n    } else {\n      return this.contributeInterface();\n    }\n  }\n\n  postCampaignInterface() {\n    if (this.state.campaign.state === this.ONGOING_STATE) {\n      return <div>\n        <Button type=\"submit\" positive>Finish campaign</Button>\n      </div>\n    }\n    if (this.state.campaign.state === this.SUCCEEDED_STATE\n        && this.state.campaign.isBeneficiary === true) {\n      return <div>\n        <Button type=\"submit\" negative>Collect funds</Button>\n      </div>\n    }\n    if (this.state.campaign.state === this.FAILED_STATE) {\n      return <div>\n        <Button type=\"submit\" negative>Refund</Button>\n      </div>\n      }\n  }\n\n  contributeInterface() {\n    return <div>\n      <Input \n        action={{\n          color: 'teal',\n          content: 'Contribute',\n          onClick: this.onContribute\n        }}\n        actionPosition='left'\n        label='ETH'\n        labelPosition='right'\n        placeholder='1'\n        onChange={(e) => this.setState({contributionAmount: e.target.value})}\n      />\n    </div>\n  }\n\n  onContribute(event) {\n    alert(`Contributing ${this.state.contributionAmount} to a contract`);\n  }\n}"]},"metadata":{},"sourceType":"module"}